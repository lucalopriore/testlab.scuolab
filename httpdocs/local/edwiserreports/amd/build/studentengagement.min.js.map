{"version":3,"sources":["studentengagement.js"],"names":["define","$","Common","CFG","SELECTOR","PAGE","TABLE","COURSE","FORMFILTER","COHORT","COHORTITEM","dataTable","cohortid","PROMISE","GET_DATA","filter","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","secret","M","local_edwiserreports","JSON","stringify","initializeDatatable","DataTable","paging","processing","serverSide","rowId","deferRendering","scrollY","scrollX","scrollCollapse","autoWidth","ordering","columns","dom","language","sSearch","util","get_string","emptyTable","rowCallback","row","html","timespentonlms","timeFormatter","timespentoncourse","callback","settings","loader","show","cohort","course","val","search","value","start","length","done","response","hide","fail","exception","init","document","ready","find","select2","on","join","reload","text","this"],"mappings":"AAAA,aAwBAA,OAAO,CAAC,SAAU,WAAY,kBAAmB,aAAc,SAAUC,EAAGC,EAAQC,GAIlF,IAAIC,EAAW,CACbC,KAAM,qBACNC,MAAO,2BACPC,OAAQ,oCACRC,WAAY,qDACZC,OAAQ,mCACRC,WAAY,yDAMVC,EAAY,KAKZC,EAAW,EAKXC,EAAU,CAMZC,SAAU,SAAkBC,GAC1B,OAAOd,EAAEe,KAAK,CACZC,IAAKd,EAAIe,WACTC,KAAMhB,EAAIiB,YACVC,SAAUlB,EAAImB,gBACdC,KAAM,CACJC,OAAQ,wCACRC,OAAQC,EAAEC,qBAAqBF,OAC/BF,KAAMK,KAAKC,UAAU,CACnBd,OAAQA,SAUlB,SAASe,IACPnB,EAAYV,EAAEG,EAASE,OAAOyB,UAAU,CACtCC,QAAQ,EACRC,YAAY,EACZC,YAAY,EACZC,MAAO,WACPC,gBAAgB,EAChBC,QAAS,QACTC,SAAS,EACTC,gBAAgB,EAChBC,WAAW,EACXC,UAAU,EACVC,QAAS,CAAC,CACRnB,KAAM,WACL,CACDA,KAAM,kBACL,CACDA,KAAM,qBACL,CACDA,KAAM,uBACL,CACDA,KAAM,uBACL,CACDA,KAAM,mBAERoB,IAAK,+GACLC,SAAU,CACRC,QAASnB,EAAEoB,KAAKC,WAAW,aAAc,wBACzCC,WAAYtB,EAAEoB,KAAKC,WAAW,aAAc,yBAE9CE,YAAa,SAAqBC,EAAK3B,GACrCtB,EAAE,WAAYiD,GAAKC,KAA4B,GAAvB5B,EAAK6B,eAAsB,IAAMlD,EAAOmD,cAAc9B,EAAK6B,iBACnFnD,EAAE,WAAYiD,GAAKC,KAA+B,GAA1B5B,EAAK+B,kBAAyB,IAAMpD,EAAOmD,cAAc9B,EAAK+B,qBAGxFtC,KAAM,SAAcO,EAAMgC,EAAUC,GAClCtD,EAAOuD,OAAOC,KAAKtD,EAASC,MAC5BQ,EAAQC,SAAS,CACf6C,OAAU/C,EACVgD,OAAU3D,EAAEG,EAASG,QAAQsD,MAC7BC,OAAUvC,EAAKuC,OAAOC,MACtBC,MAASzC,EAAKyC,MACdC,OAAU1C,EAAK0C,SACdC,KAAK,SAAUC,GAChBjE,EAAOuD,OAAOW,KAAKhE,EAASC,MAC5BkD,EAASY,KACRE,KAAK,SAAUC,GAChBpE,EAAOuD,OAAOW,KAAKhE,EAASC,WAwCpC,MAAO,CACLkE,KAAM,WACJtE,EAAEuE,UAAUC,MAAM,WA9BpBxE,EAAEG,EAASC,MAAMqE,KAAK,iBAAiBC,UAEvC1E,EAAEG,EAASG,QAAQqE,GAAG,SAAU,WAC9B3E,EAAEG,EAASI,YAAYqD,IAAI,CAACjD,EAAUX,EAAEG,EAASG,QAAQsD,OAAOgB,KAAK,MAEnD,OAAdlE,EAKJA,EAAUK,KAAK8D,SAJbhD,MAOJ7B,EAAEG,EAASM,YAAYkE,GAAG,QAAS,WACjC3E,EAAEG,EAASK,QAAQsE,KAAK9E,EAAE+E,MAAMD,QAChCnE,EAAWX,EAAE+E,MAAMzD,KAAK,YACxBtB,EAAEG,EAASI,YAAYqD,IAAI,CAACjD,EAAUX,EAAEG,EAASG,QAAQsD,OAAOgB,KAAK,MAEnD,OAAdlE,EAKJA,EAAUK,KAAK8D,SAJbhD,MAMJA","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Plugin administration pages are defined here.\n *\n * @package     local_edwiserreports\n * @copyright   2021 wisdmlabs <support@wisdmlabs.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    './common',\n    './defaultconfig',\n    './select2'\n], function(\n    $,\n    Common,\n    CFG\n) {\n\n    /**\n     * Selector\n     */\n    var SELECTOR = {\n        PAGE: '#studentengagement',\n        TABLE: '#studentengagement table',\n        COURSE: '#studentengagement .course-select',\n        FORMFILTER: '#studentengagement .download-links [name=\"filter\"]',\n        COHORT: '#studentengagement #cohortfilter',\n        COHORTITEM: '#studentengagement #cohortfilter + div .dropdown-item'\n    };\n\n    /**\n     * Datatable object.\n     */\n    var dataTable = null;\n\n    /**\n     * Cohort id.\n     */\n    var cohortid = 0;\n\n    /**\n     * All promises.\n     */\n    var PROMISE = {\n        /**\n         * Get student engagement table data based on filters.\n         * @param {Object} filter Filter data\n         * @returns {PROMISE}\n         */\n         GET_DATA: function(filter) {\n            return $.ajax({\n                url: CFG.requestUrl,\n                type: CFG.requestType,\n                dataType: CFG.requestDataType,\n                data: {\n                    action: 'get_studentengagement_table_data_ajax',\n                    secret: M.local_edwiserreports.secret,\n                    data: JSON.stringify({\n                        filter: filter\n                    })\n                },\n            });\n        },\n    }\n\n    /**\n     * Initialize datable.\n     */\n    function initializeDatatable() {\n        dataTable = $(SELECTOR.TABLE).DataTable({\n            paging: true,\n            processing: true,\n            serverSide: true,\n            rowId: 'DT_RowId',\n            deferRendering: true,\n            scrollY: \"400px\",\n            scrollX: true,\n            scrollCollapse: true,\n            autoWidth: true,\n            ordering: false,\n            columns: [\n                {data: \"student\"},\n                {data: \"timespentonlms\"},\n                {data: \"timespentoncourse\"},\n                {data: \"assignmentsubmitted\"},\n                {data: \"activitiescompleted\"},\n                {data: \"visitsoncourse\"}\n            ],\n            dom: '<\"edw-studentengagement-top\"<\"edw-listing\"l><\"edw-list-filtering\"f>>t<\"edw-bottom\"<' +\n            '\"edw-list-pagination\"p>>i',\n            language: {\n                sSearch: M.util.get_string('searchuser', 'local_edwiserreports'),\n                emptyTable: M.util.get_string('emptytable', 'local_edwiserreports')\n            },\n            rowCallback: function(row, data) {\n                $('td:eq(1)', row).html(data.timespentonlms == 0 ? '-' : Common.timeFormatter(data.timespentonlms));\n                $('td:eq(2)', row).html(data.timespentoncourse == 0 ? '-' : Common.timeFormatter(data.timespentoncourse));\n            },\n            // eslint-disable-next-line no-unused-vars\n            ajax: function(data, callback, settings) {\n                Common.loader.show(SELECTOR.PAGE);\n                PROMISE.GET_DATA({\n                    'cohort': cohortid,\n                    'course': $(SELECTOR.COURSE).val(),\n                    'search': data.search.value,\n                    'start': data.start,\n                    'length': data.length\n                }).done(function(response) {\n                    Common.loader.hide(SELECTOR.PAGE);\n                    callback(response);\n                }).fail(function(exception) {\n                    Common.loader.hide(SELECTOR.PAGE);\n                });\n            }\n        });\n    }\n\n    /**\n     * Initialize\n     */\n    function init() {\n        // Initialize select2.\n        $(SELECTOR.PAGE).find('.singleselect').select2();\n\n        // Observer course change event.\n        $(SELECTOR.COURSE).on('change', function() {\n            $(SELECTOR.FORMFILTER).val([cohortid, $(SELECTOR.COURSE).val()].join('-'));\n            if (dataTable === null) {\n                initializeDatatable();\n                return;\n            }\n            dataTable.ajax.reload();\n        });\n\n        // Observer cohort change.\n        $(SELECTOR.COHORTITEM).on('click', function() {\n            $(SELECTOR.COHORT).text($(this).text());\n            cohortid = $(this).data('cohortid');\n            $(SELECTOR.FORMFILTER).val([cohortid, $(SELECTOR.COURSE).val()].join('-'));\n            if (dataTable === null) {\n                initializeDatatable();\n                return;\n            }\n            dataTable.ajax.reload();\n        });\n\n        initializeDatatable();\n\n    }\n\n    return {\n        init: function() {\n            $(document).ready(function() {\n                init();\n            });\n        }\n    };\n\n});\n"],"file":"studentengagement.min.js"}