"use strict";define(["jquery","./chart/apexcharts","core/notification","./defaultconfig","./variables","./common","./flatpickr"],function(e,a,t,o,r,l){var n=null,s=null,i=o.getPanel("#activeusersblock"),d=o.getPanel("#activeusersblock","body"),c=(o.getPanel("#activeusersblock","title"),o.getPanel("#activeusersblock","footer")),p=i+" .dropdown-menu[aria-labelledby='filter-dropdown']:not('custom')",h=p+" .dropdown-item",u=i+" #filter-dropdown.dropdown-toggle",m=i+" #flatpickrCalender",f=d+" .ct-chart",g=d+" .loader",v=i+" button#filter-dropdown",b=d+" .refresh",y=i+r.exportUrlLink,w=null,k=d+" input.form-control.input",x={series:[],chart:{type:"area",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},stroke:{curve:"smooth"},grid:{borderColor:"#e7e7e7"},markers:{size:1},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},legend:{position:"top",floating:!0},dataLabels:{enabled:!1}};return{init:function(i){function C(r){e(f).hide(),e(g).show(),r||(r="weekly"),l.loader.show("#activeusersblock"),e.ajax({url:o.requestUrl,type:o.requestType,dataType:o.requestDataType,data:{action:"get_activeusers_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({precalculated:-1!==["weekly","monthly","yearly"].indexOf(r),filter:r,graphajax:!0})}}).done(function(e){!0!==e.error||"invalidsecretkey"!==e.exception.errorcode?(n.graph.data=e.data,n.graph.labels=e.labels):i("activeusersblock",e)}).fail(function(e){t.exception(e)}).always(function(){s&&s.destroy(),(s=new a(e("#apex-chart-active-users").get(0),function(){var e=Object.assign({},x);try{e.series=[{name:n.graph.labelName.activeUsers,data:n.graph.data.activeUsers},{name:n.graph.labelName.enrolments,data:n.graph.data.enrolments},{name:n.graph.labelName.completionRate,data:n.graph.data.completionRate}],e.xaxis.categories=n.graph.labels,e.chart.toolbar.show=n.graph.labels.length>30,e.chart.zoom.enabled=n.graph.labels.length>30}catch(a){e.series=[],e.xaxis.categories=[],e.chart.toolbar.show=!1,e.chart.zoom.enabled=!1}return e}())).render(),s=s,e(c).find('.download-links input[name="filter"]').val(r),e(d+" #updated-time > span.minute").html(0),setInterval(O,6e4),e(b).removeClass("refresh-spin"),e(g).hide(),e(f).fadeIn("slow"),l.loader.hide("#activeusersblock")})}function O(){e(d+" #updated-time > span.minute").html(parseInt(e(d+" #updated-time > span.minute").text())+1)}(n=o.getActiveUsersBlock())&&(e(u).on("click",function(){e(p).addClass("show")}),e(k).ready(function(){var a=e(k).attr("placeholder");e(k).val(a)}),e(document).click(function(a){e(a.target).hasClass("dropdown-menu")||e(a.target).parents(".dropdown-menu").length||e(p).removeClass("show")}),e(h+":not(.custom)").on("click",function(){w=e(this).attr("value"),e(p).removeClass("show"),e(v).html(e(this).text()),C(w),e(m).val("Custom"),e(k).val("Custom")}),e(b).on("click",function(){e(this).addClass("refresh-spin"),C(w)}),e(m).flatpickr({mode:"range",altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:document.getElementById("activeUser-calendar"),onOpen:function(){e(p).addClass("withcalendar")},onClose:function(){e(p).removeClass("withcalendar"),e(p).removeClass("show"),function(){w=e(m).val();var a=e(k).val();w.includes("to")&&(o.changeExportUrl(w,y,r.filterReplaceFlag),e(v).html(a),e(m).val(""),C(w))}()}}),C())}}});
//# sourceMappingURL=block_activeusers.min.js.map
