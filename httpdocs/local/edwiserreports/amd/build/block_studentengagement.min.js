"use strict";define(["jquery","core/ajax","core/templates","./chart/apexcharts","./common","./defaultconfig","./select2"],function(e,t,a,n,s,o){var i=["visitsonlms","timespentonlms","timespentoncourse","courseactivitystatus"],r={visitsonlms:null,timespentonlms:null,timespentoncourse:null,courseactivitystatus:null},l={visitsonlms:null,timespentonlms:null,timespentoncourse:null,courseactivitystatus:null},d={visitsonlms:{date:"weekly",student:0},timespentonlms:{date:"weekly",student:0},timespentoncourse:{date:"weekly",course:0,student:0},courseactivitystatus:{date:"weekly",course:0,student:0}},c={series:[],chart:{type:"area",height:350,dropShadow:{enabled:!0,color:"#000",top:18,left:7,blur:10,opacity:.2},toolbar:{show:!1,tools:{download:!1,reset:'<i class="fa fa-refresh"></i>'}},zoom:{enabled:!1}},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},stroke:{curve:"smooth"},grid:{borderColor:"#e7e7e7"},markers:{size:1},xaxis:{categories:null,type:"datetime",labels:{hideOverlappingLabels:!0,datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:""}},tooltip:{enabled:!1}},legend:{position:"top",floating:!0},dataLabels:{enabled:!1},noData:{text:M.util.get_string("nographdata","local_edwiserreports")}},u={series:[],chart:{type:"bar",height:350,toolbar:{show:!0,tools:{download:!1,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:'<i class="fa fa-refresh"></i>'}}},tooltip:{enabled:!0,enabledOnSeries:void 0,shared:!0,followCursor:!1,intersect:!1,inverseOrder:!1,fillSeriesColor:!1,onDatasetHover:{highlightDataSeries:!1},y:{formatter:void 0,title:{}},marker:{show:!0},items:{display:"flex"},fixed:{enabled:!1,position:"topRight",offsetX:0,offsetY:0}},plotOptions:{bar:{columnWidth:"50%"}},grid:{borderColor:"#e7e7e7"},dataLabels:{enabled:!1},xaxis:{categories:null,labels:{hideOverlappingLabels:!0,trim:!0},tickPlacement:"on"},noData:{text:M.util.get_string("nographdata","local_edwiserreports")}},f={PANEL:"#studentengagementblock",DATE:".studentengagement-calendar",DATEMENU:".studentengagement-calendar + .dropdown-menu",DATEITEM:".studentengagement-calendar + .dropdown-menu .dropdown-item",DATEPICKER:".studentengagement-calendar + .dropdown-menu .dropdown-calendar",DATEPICKERINPUT:".studentengagement-calendar + .dropdown-menu .flatpickr",FORMFILTER:'.download-links [name="filter"]',COURSE:".course-select",STUDENT:".student-select",GRAPH:".graph",GRAPHS:".studentengagement-graphs",FILTERS:".filters",VISITSONLMS:".visitsonlms",TIMESPENTONLMS:".timespentonlms",TIMESPENTONCOURSE:".timespentoncourse",COURSEACTIVITYSTATUS:".courseactivitystatus"},m={GET_STUDENTS:function(e){return t.call([{methodname:"local_edwiserreports_get_students_of_course",args:{courseid:e}}],!1)[0]},GET_VISITSONLMS:function(t){return e.ajax({url:o.requestUrl,type:o.requestType,dataType:o.requestDataType,data:{action:"get_studentengagement_visitsonlms_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({filter:t})}})},GET_TIMESPENTONLMS:function(t){return e.ajax({url:o.requestUrl,type:o.requestType,dataType:o.requestDataType,data:{action:"get_studentengagement_timespentonlms_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({filter:t})}})},GET_TIMESPENTONCOURSE:function(t){return e.ajax({url:o.requestUrl,type:o.requestType,dataType:o.requestDataType,data:{action:"get_studentengagement_timespentoncourse_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({filter:t})}})},GET_COURSEACTIVITYSTATUS:function(t){return e.ajax({url:o.requestUrl,type:o.requestType,dataType:o.requestDataType,data:{action:"get_studentengagement_courseactivitystatus_graph_data_ajax",secret:M.local_edwiserreports.secret,data:JSON.stringify({filter:t})}})}};function g(t){s.loader.show("#studentengagementblock ."+t);var a=Object.keys(d[t]).map(function(e){return d[t][e]}).join("-")+"-"+t;function o(e,a){null!==l[t]&&l[t].destroy(),l[t]=new n(e.get(0),a),l[t].render(),setTimeout(function(){s.loader.hide("#studentengagementblock ."+t)},1e3)}switch(e(f.PANEL).find(".".concat(t)).find(f.FORMFILTER).val(a),t){case"visitsonlms":m.GET_VISITSONLMS(d[t]).done(function(t){var a=Object.assign({},c);a.series=[{name:M.util.get_string("visitsonlms","local_edwiserreports"),data:t.visits}],a.xaxis.categories=t.labels,a.chart.toolbar.show=t.labels.length>30,a.chart.zoom.enabled=t.labels.length>30,a.tooltip.y.title.formatter=function(){return M.util.get_string("visits","local_edwiserreports")+": "},o(e(f.PANEL).find(f.VISITSONLMS).find(f.GRAPH),a)}).fail(function(e){s.loader.hide("#studentengagementblock ."+t)});break;case"timespentonlms":m.GET_TIMESPENTONLMS(d[t]).done(function(t){var a=Object.assign({},c);a.series=[{name:M.util.get_string("timespentonlms","local_edwiserreports"),data:t.timespent}],a.yaxis={labels:{formatter:s.timeFormatter}},a.xaxis.categories=t.labels,a.chart.toolbar.show=t.labels.length>30,a.chart.zoom.enabled=t.labels.length>30,a.tooltip.y.title.formatter=function(){return M.util.get_string("time","local_edwiserreports")+": "},o(e(f.PANEL).find(f.TIMESPENTONLMS).find(f.GRAPH),a)}).fail(function(e){s.loader.hide("#studentengagementblock ."+t)});break;case"timespentoncourse":m.GET_TIMESPENTONCOURSE(d[t]).done(function(a){var n;(n=0==d[t].course?Object.assign({},u):Object.assign({},c)).series=[{name:M.util.get_string("timespentoncourse","local_edwiserreports"),data:a.timespent}],n.xaxis.categories=a.labels,n.yaxis={labels:{formatter:s.timeFormatter}},n.chart.toolbar.show=a.labels.length>30,n.chart.zoom={enabled:a.labels.length>30},n.tooltip.y.title.formatter=function(){return M.util.get_string("time","local_edwiserreports")+": "},o(e(f.PANEL).find(f.TIMESPENTONCOURSE).find(f.GRAPH),n)}).fail(function(e){s.loader.hide("#studentengagementblock ."+t)});break;case"courseactivitystatus":m.GET_COURSEACTIVITYSTATUS(d[t]).done(function(t){var a=Object.assign({},c);a.series=[{name:M.util.get_string("courseactivitystatus-submissions","local_edwiserreports"),data:t.submissions},{name:M.util.get_string("courseactivitystatus-completions","local_edwiserreports"),data:t.completions}],a.xaxis.categories=t.labels,a.chart.toolbar.show=t.labels.length>30,a.chart.zoom.enabled=t.labels.length>30,a.tooltip.y.title.formatter=null,o(e(f.PANEL).find(f.COURSEACTIVITYSTATUS).find(f.GRAPH),a)}).fail(function(e){s.loader.hide("#studentengagementblock ."+t)});break;default:s.loader.hide("#studentengagementblock ."+t)}}function p(){e("body").on("click",f.DATEITEM+":not(.custom)",function(){var t=e(this).closest(f.FILTERS).data("id");e(f.PANEL).find("."+t).find(f.DATEITEM).removeClass("active"),e(this).addClass("active"),e(f.PANEL).find("."+t).find(f.DATE).html(e(this).text()),r[t].clear(),d[t].date=e(this).data("value"),g(t)}),e("body").on("change","".concat(f.PANEL," ").concat(f.COURSE),function(){var t=e(this).closest(f.FILTERS).data("id"),n=parseInt(e(this).val());d[t].course=n,d[t].student=0,m.GET_STUDENTS(n).done(function(n){e(f.PANEL).find("."+t).find(f.STUDENT).select2("destroy"),a.render("local_edwiserreports/studentengagement/students_filter",{students:n}).done(function(n,s){a.replaceNode(e(f.PANEL).find("."+t).find(f.STUDENT),n,s),e(f.PANEL).find("."+t).find(f.STUDENT).select2()})}),g(t)}),e("body").on("change","".concat(f.PANEL," ").concat(f.STUDENT),function(){var t=e(this).closest(f.FILTERS).data("id");d[t].student=parseInt(e(this).val()),g(t)}),i.forEach(function(t){r[t]=e(f.PANEL).find("."+t).find(f.DATEPICKERINPUT).flatpickr({mode:"range",altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:e(f.PANEL).find("."+t).find(f.DATEPICKER).get(0),onOpen:function(){e(f.PANEL).find("."+t).find(f.DATEMENU).addClass("withcalendar")},onClose:function(){e(f.PANEL).find("."+t).find(f.DATEMENU).removeClass("withcalendar"),function(t){var a=e(f.PANEL).find("."+t).find(f.DATEPICKERINPUT).val(),n=e(f.PANEL).find("."+t).find(f.DATEPICKERINPUT).next().val();n.includes("to")?(e(f.PANEL).find("."+t).find(f.DATEITEM).removeClass("active"),e(f.PANEL).find("."+t).find(f.DATEITEM+".custom").addClass("active"),e(f.PANEL).find("."+t).find(f.DATE).html(n),d[t].date=a,g(t)):r[t].clear()}(t)}})})}return{init:function(t){0!=e(f.PANEL).length&&(e(f.PANEL).find(".singleselect").select2(),p(),i.forEach(function(e){g(e)}))}}});
//# sourceMappingURL=block_studentengagement.min.js.map
